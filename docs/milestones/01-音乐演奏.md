# 里程碑一：音乐演奏

> 状态：待确认 | 优先级：P0

## 目标

**让用户用电脑键盘快速弹奏出旋律，< 1 分钟内上手。**

---

## 用户故事

| 编号 | 场景 | 预期行为 |
|-----|------|---------|
| US-01 | 打开页面 | 看到键盘界面 + 立即可弹奏 |
| US-02 | 按下按键 | 听到对应音符（无延迟） |
| US-03 | 按住按键 | 音符持续发声，松开停止 |
| US-04 | 切换音色 | 从当前音色切换到另一种 |
| US-05 | 可视反馈 | 按键时有视觉高亮，显示当前音符 |

---

## 功能范围

### ✅ 做

| 功能 | 描述 |
|-----|------|
| 键盘映射 | QWERTY 键盘 → 音符（C3-C5，1.5 octaves） |
| 实时演奏 | 按键即响，延迟 < 50ms |
| 音色切换 | 至少 3 种：钢琴、合成器、鼓 |
| 视觉反馈 | 按键高亮 + 当前音符显示 |

### ❌ 不做

- 延音踏板支持
- 力度感应（Web 键盘无法获取）
- 多指和弦识别
- MIDI 输入设备支持

---

## 键盘映射方案

### 映射规则

```
行 3（A 键）= 基准音（默认 C3）
同行右移 = +1 半音
行之间（从上到下）= ±1 八度

行 1（A 上 2 行）= 基准 + 2 八度 (+24)
行 2（A 上 1 行）= 基准 + 1 八度 (+12)
行 3（A 所在行）= 基准音 (默认 C3)
行 4（A 下 1 行）= 基准 - 1 八度 (-12)
```

### 完整映射表（基准 = C3）

```
【行 1】1   2   3   4   5   6   7   8   9   0   -   =
【行 1】C5 C#5 D5 D#5 E5 F5 F#5 G5 G#5 A5 A#5 B5

【行 2】Q   W   E   R   T   Y   U   I   O   P   [   ]   \
【行 2】C4 C#4 D4 D#4 E4 F4 F#4 G4 G#4 A4 A#4 B4 C5

【行 3】A   S   D   F   G   H   J   K   L   ;   '
【行 3】C3 C#3 D3 D#3 E3 F3 F#3 G3 G#3 A3 A#3

【行 4】Z   X   C   V   B   N   M   ,   .   /
【行 4】C2 C#2 D2 D#2 E2 F2 F#2 G2 G#2 A2
```

> **当前范围**：C2 - B5（3 octaves + 白键）
> **可配置**：基准音可自定义（默认 C3）

---

## 音色定义

| 音色 ID | 名称 | 声音来源 |
|--------|------|---------|
| piano | 钢琴 | Oscillator (sine/sawtooth + envelope) |
| synth | 合成器 | Oscillator (square + filter) |
| guitar | 电吉他 | Oscillator (sawtooth + distortion) |
| drum | 鼓组 | 预制采样或 Oscillator 模拟 |

> **音色切换**：通过 UI 按钮实现，暂不包含快捷键

---

## 交互设计

### 页面布局

```
┌─────────────────────────────────────┐
│ 🎵 AI Music Creator          [音色▼]│
├─────────────────────────────────────┤
│                                     │
│    ┌─────────────────────────────┐  │
│    │  可视键盘 (2.5 octaves)     │  │
│    │  [C3][D3][E3][F3]...[A5]   │  │
│    └─────────────────────────────┘  │
│                                     │
│  当前音符: C4                       │
│                                     │
└─────────────────────────────────────┘
```

> **音色切换**：通过下拉菜单选择

---

## 成功标准

| 指标 | 目标 |
|-----|------|
| 首次上手时间 | < 30 秒 |
| 演奏延迟 | < 50ms |
| 键盘覆盖范围 | C3 - A5（2.5 octaves） |
| 音色数量 | ≥ 4 种 |

---

## 待确认项

- [ ] 是否需要黑键映射？

---

## 后续迭代（v2+）

- 黑键映射
- 力度感应（仅 MIDI 键盘）
- 延音踏板
- 录音回放
