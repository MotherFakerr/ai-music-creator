# 里程碑一：音乐演奏

> 状态：待确认 | 优先级：P0

## 目标

**让用户用电脑键盘快速弹奏出旋律，< 1 分钟内上手。**

---

## 用户故事

| 编号 | 场景 | 预期行为 |
|-----|------|---------|
| US-01 | 打开页面 | 看到键盘界面 + 立即可弹奏 |
| US-02 | 按下按键 | 听到对应音符（无延迟） |
| US-03 | 按住按键 | 音符持续发声，松开停止 |
| US-04 | 切换音色 | 从当前音色切换到另一种 |
| US-05 | 可视反馈 | 按键时有视觉高亮，显示当前音符 |

---

## 功能范围

### ✅ 做

| 功能 | 描述 |
|-----|------|
| 键盘映射 | QWERTY 键盘 → 音符（C3-C5，1.5 octaves） |
| 实时演奏 | 按键即响，延迟 < 50ms |
| 音色切换 | 至少 3 种：钢琴、合成器、鼓 |
| 视觉反馈 | 按键高亮 + 当前音符显示 |

### ❌ 不做

- 延音踏板支持
- 力度感应（Web 键盘无法获取）
- 多指和弦识别
- MIDI 输入设备支持

---

## 键盘映射方案

### 映射规则（白键 + 黑键）

```
数字键行:  1  2  3  4  5  6  7  8  9  0
           │  │     │  │     │  │     │
主键盘行:  Q  W  E  R  T  Y  U  I  O  P
           C3 D3 E3 F3 G3 A3 B3 C4 D4 E4
           │  │  │  │  │  │  │  │  │  │
           │  │  │  │  │  │  │  │  │  │
           2  3     5  6     8  9
           C#3 D#3 F#3 G#3 A#3 C#5 D#5
           
辅助键盘:  A  S  D  F  G  H  J  K  L  ;  '
           F3 G3 A3 B3 C5 D5 E5 F5 G5 A5
           │  │  │  │  │  │  │  │  │  │
           │  │  │  │  │  │  │  │  │  │
           W  E     T  Y     O  P
           F#3 G#3 A#3 C#5 D#5
```

### 完整映射表

| 按键 | 音高 | 类型 |
|-----|------|------|
| **主键盘区** |
| Q | C3 | 白 |
| 2 | C#3 | 黑 |
| W | D3 | 白 |
| 3 | D#3 | 黑 |
| E | E3 | 白 |
| R | F3 | 白 |
| 5 | F#3 | 黑 |
| T | G3 | 白 |
| 6 | G#3 | 黑 |
| Y | A3 | 白 |
| 7 | A#3 | 黑 |
| U | B3 | 白 |
| I | C4 | 白 |
| 8 | C#4 | 黑 |
| O | D4 | 白 |
| 9 | D#4 | 黑 |
| P | E4 | 白 |
| **辅助键盘区** |
| A | F3 | 白 |
| W | F#3 | 黑 |
| S | G3 | 白 |
| E | G#3 | 黑 |
| D | A3 | 白 |
| F | B3 | 白 |
| T | A#3 | 黑 |
| G | C5 | 白 |
| Y | C#5 | 黑 |
| H | D5 | 白 |
| O | D#5 | 黑 |
| J | E5 | 白 |
| K | F5 | 白 |
| P | F#5 | 黑 |
| L | G5 | 白 |
| ; | G#5 | 黑 |
| ' | A5 | 白 |

> **当前范围**：C3 - A5（2.5 octaves，20 白键 + 14 黑键）

---

## 音色定义

| 音色 ID | 名称 | 声音来源 |
|--------|------|---------|
| piano | 钢琴 | Oscillator (sine/sawtooth + envelope) |
| synth | 合成器 | Oscillator (square + filter) |
| guitar | 电吉他 | Oscillator (sawtooth + distortion) |
| drum | 鼓组 | 预制采样或 Oscillator 模拟 |

> **音色切换**：通过 UI 按钮实现，暂不包含快捷键

---

## 交互设计

### 页面布局

```
┌─────────────────────────────────────┐
│ 🎵 AI Music Creator          [音色▼]│
├─────────────────────────────────────┤
│                                     │
│    ┌─────────────────────────────┐  │
│    │  可视键盘 (2.5 octaves)     │  │
│    │  [C3][D3][E3][F3]...[A5]   │  │
│    └─────────────────────────────┘  │
│                                     │
│  当前音符: C4                       │
│                                     │
└─────────────────────────────────────┘
```

> **音色切换**：通过下拉菜单选择

---

## 成功标准

| 指标 | 目标 |
|-----|------|
| 首次上手时间 | < 30 秒 |
| 演奏延迟 | < 50ms |
| 键盘覆盖范围 | C3 - A5（2.5 octaves） |
| 音色数量 | ≥ 4 种 |

---

## 待确认项

- [ ] 是否需要黑键映射？

---

## 后续迭代（v2+）

- 黑键映射
- 力度感应（仅 MIDI 键盘）
- 延音踏板
- 录音回放
